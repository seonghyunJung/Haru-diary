{% extends 'base.html' %}
{% block content %}
    <div class="container">
        <div class="">
            <span>üóìÔ∏è</span>
            <input type="text" name="daterange" id="txtDate" style="text-align: center;"/>
        </div>
        <canvas id="myChart"></canvas>
    </div>
{% endblock %}
{% block script %}
    <script type="text/javascript">
        $(function () {
            var ctx = document.getElementById('myChart');
            let statistics = JSON.parse("{{ statistics | escapejs }}");
            let myChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['neutral', 'happy', 'sad', 'angry', 'disgust', 'fear', 'surprise'],
                    datasets: [{
                        label: 'Í∞êÏ†ï ÌÜµÍ≥Ñ',
                        data: [statistics["neutral"], statistics["happiness"], statistics["sadness"], statistics["angry"], statistics["disgust"], statistics["fear"], statistics["surprise"]],
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.2)',
                            'rgba(54, 162, 235, 0.2)',
                            'rgba(255, 206, 86, 0.2)',
                            'rgba(75, 192, 192, 0.2)',
                            'rgba(153, 102, 255, 0.2)',
                            'rgba(255, 159, 64, 0.2)'
                        ],
                        borderColor: [
                            'rgba(255, 99, 132, 1)',
                            'rgba(54, 162, 235, 1)',
                            'rgba(255, 206, 86, 1)',
                            'rgba(75, 192, 192, 1)',
                            'rgba(153, 102, 255, 1)',
                            'rgba(255, 159, 64, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    scales: {
                        yAxes: [{
                            ticks: {
                                min: 0,
                                max: 100,
                                callback: function (value) {
                                    return value + "%"
                                }
                            },
                            scaleLabel: {
                                display: true,
                                labelString: "Percentage"
                            }
                        }]
                    }
                }
            });
            $('#txtDate').daterangepicker({
                locale: {
                    "separator": " ~ ",                     // ÏãúÏûëÏùºÏãúÏôÄ Ï¢ÖÎ£åÏùºÏãú Íµ¨Î∂ÑÏûê
                    "format": 'YYYY-MM-DD',     // ÏùºÏãú ÎÖ∏Ï∂ú Ìè¨Îß∑
                    "applyLabel": "ÌôïÏù∏",                    // ÌôïÏù∏ Î≤ÑÌäº ÌÖçÏä§Ìä∏
                    "cancelLabel": "Ï∑®ÏÜå",                   // Ï∑®ÏÜå Î≤ÑÌäº ÌÖçÏä§Ìä∏
                    "daysOfWeek": ["Ïùº", "Ïõî", "Ìôî", "Ïàò", "Î™©", "Í∏à", "ÌÜ†"],
                    "monthNames": ["1Ïõî", "2Ïõî", "3Ïõî", "4Ïõî", "5Ïõî", "6Ïõî", "7Ïõî", "8Ïõî", "9Ïõî", "10Ïõî", "11Ïõî", "12Ïõî"]
                },
                showDropdowns: true,                     // ÎÖÑÏõî ÏàòÎèô ÏÑ§Ï†ï Ïó¨Î∂Ä
                {#autoApply: true,                         // ÌôïÏù∏/Ï∑®ÏÜå Î≤ÑÌäº ÏÇ¨Ïö©Ïó¨Î∂Ä#}
                timePicker24Hour: true,                  // 24ÏãúÍ∞Ñ ÎÖ∏Ï∂ú Ïó¨Î∂Ä(ex> true : 23:50, false : PM 11:50)
                timePickerSeconds: true,                 // Ï¥à ÎÖ∏Ï∂ú Ïó¨Î∂Ä
            }, function (start, end, label) {
                data = {
                    "start": start.format('YYYY-MM-DD'),
                    "end": end.format('YYYY-MM-DD'),
                };
                $.ajax({
                    url: '{% url "haru:graph_page" %}',
                    type: 'POST',
                    dataType: "json",
                    data: JSON.stringify(data),
                    success: function (json) {
                        statistics = JSON.parse(json["statistics"])
                        let myChart = new Chart(ctx, {
                            type: 'bar',
                            data: {
                                labels: ['neutral', 'happy', 'sad', 'angry', 'disgust', 'fear', 'surprise'],
                                datasets: [{
                                    label: 'Í∞êÏ†ï ÌÜµÍ≥Ñ',
                                    data: [statistics["neutral"], statistics["happiness"], statistics["sadness"], statistics["angry"], statistics["disgust"], statistics["fear"], statistics["surprise"]],
                                    backgroundColor: [
                                        'rgba(255, 99, 132, 0.2)',
                                        'rgba(54, 162, 235, 0.2)',
                                        'rgba(255, 206, 86, 0.2)',
                                        'rgba(75, 192, 192, 0.2)',
                                        'rgba(153, 102, 255, 0.2)',
                                        'rgba(255, 159, 64, 0.2)'
                                    ],
                                    borderColor: [
                                        'rgba(255, 99, 132, 1)',
                                        'rgba(54, 162, 235, 1)',
                                        'rgba(255, 206, 86, 1)',
                                        'rgba(75, 192, 192, 1)',
                                        'rgba(153, 102, 255, 1)',
                                        'rgba(255, 159, 64, 1)'
                                    ],
                                    borderWidth: 1
                                }]
                            },
                            options: {
                                scales: {
                                    yAxes: [{
                                        ticks: {
                                            min: 0,
                                            max: 100,
                                            callback: function (value) {
                                                return value + "%"
                                            }
                                        },
                                        scaleLabel: {
                                            display: true,
                                            labelString: "Percentage"
                                        }
                                    }]
                                }
                            }
                        });
                    },
                    error: function (xhr, errmsg, err) {
                        {#console.log(xhr.status + ": " + xhr.responseText);#}
                        console.log(err);
                        console.log(data);
                    }
                });
                /*
                .done(function (data) {
                    alert("Í≤∞Ï†úÍ∞Ä ÏÑ±Í≥µÏ†ÅÏúºÎ°ú ÏßÑÌñâÎêòÏóàÏäµÎãàÎã§.");
                }).fail(function (data) {
                    alert("Í≤∞Ï†úÏ§ë ÏÑúÎ≤ÑÏôÄÏùò ÌÜµÏã†Ïóê Î¨∏Ï†úÍ∞Ä Î∞úÏÉùÌïòÏòÄÏäµÎãàÎã§.\nÏõêÏù∏: " + data.value);
                });
                 */
                console.log("A new date selection was made: " + start.format('YYYY-MM-DD') + ' to ' + end.format('YYYY-MM-DD'));
            });

            /*
           $('#txtDate').on('show.daterangepicker', function (ev, picker) {
               $(".yearselect").css("float", "left");
               $(".monthselect").css("float", "right");
               $(".cancelBtn").css("float", "right");
           });
             */
        })
    </script>

    {#    <script type="text/javascript">#}
    {#        var ctx = document.getElementById('myChart');#}
    {#        let statistics = JSON.parse("{{ statistics | escapejs }}");#}
    {#        var myChart = new Chart(ctx, {#}
    {#            type: 'bar',#}
    {#            data: {#}
    {#                labels: ['neutral', 'happy', 'sad', 'angry', 'disgust', 'fear', 'surprise'],#}
    {#                datasets: [{#}
    {#                    label: 'Í∞êÏ†ï ÌÜµÍ≥Ñ',#}
    {#                    data: [statistics["neutral"], statistics["happiness"], statistics["sadness"], statistics["angry"], statistics["disgust"], statistics["fear"], statistics["surprise"]],#}
    {#                    backgroundColor: [#}
    {#                        'rgba(255, 99, 132, 0.2)',#}
    {#                        'rgba(54, 162, 235, 0.2)',#}
    {#                        'rgba(255, 206, 86, 0.2)',#}
    {#                        'rgba(75, 192, 192, 0.2)',#}
    {#                        'rgba(153, 102, 255, 0.2)',#}
    {#                        'rgba(255, 159, 64, 0.2)'#}
    {#                    ],#}
    {#                    borderColor: [#}
    {#                        'rgba(255, 99, 132, 1)',#}
    {#                        'rgba(54, 162, 235, 1)',#}
    {#                        'rgba(255, 206, 86, 1)',#}
    {#                        'rgba(75, 192, 192, 1)',#}
    {#                        'rgba(153, 102, 255, 1)',#}
    {#                        'rgba(255, 159, 64, 1)'#}
    {#                    ],#}
    {#                    borderWidth: 1#}
    {#                }]#}
    {#            },#}
    {#            options: {#}
    {#                scales: {#}
    {#                    yAxes: [{#}
    {#                        ticks: {#}
    {#                            min: 0,#}
    {#                            max: 100,#}
    {#                            callback: function (value) {#}
    {#                                return value + "%"#}
    {#                            }#}
    {#                        },#}
    {#                        scaleLabel: {#}
    {#                            display: true,#}
    {#                            labelString: "Percentage"#}
    {#                        }#}
    {#                    }]#}
    {#                }#}
    {#            }#}
    {#        });#}
    {#    </script>#}
{% endblock %}